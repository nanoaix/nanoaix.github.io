<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>以损订仓</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #f7f8fa 60%, #eaf1ff 100%);
      min-height: 100vh;
      padding: 16px;
    }
    
    .calculator {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h3 {
      font-size: 24px;
      font-weight: 900;
      color: #1a237e;
      margin-bottom: 24px;
      letter-spacing: 1px;
      text-shadow: 0 2px 8px #e3e8f7;
      text-align: center;
    }
    
    .calculator-card {
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(22, 119, 255, 0.1);
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .input-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }
    
    .input-group label {
      font-size: 15px;
      font-weight: 600;
      color: #4b5563;
    }
    
    .input-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      flex-wrap: wrap;
    }
    
    .result-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    .result-card {
      background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
      border-radius: 16px;
      padding: 16px;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .result-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(22, 119, 255, 0.1);
    }
    
    .result-label {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    
    .result-value {
      font-size: 28px;
      font-weight: 800;
      color: #1677ff;
      margin-bottom: 4px;
      transition: all 0.3s ease;
    }
    
    .result-value.changed {
      animation: highlight 0.5s ease;
    }
    
    @keyframes highlight {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); background-color: rgba(22, 119, 255, 0.1); }
      100% { transform: scale(1); }
    }
    
    .result-unit {
      font-size: 14px;
      color: #9ca3af;
    }
    
    input[type="number"] {
      width: 100px;
      padding: 10px;
      border: 1.5px solid #e5e6eb;
      border-radius: 8px;
      font-size: 16px;
      outline: none;
      background: #fafdff;
      margin: 0 2px;
      transition: border 0.2s, box-shadow 0.2s;
      -webkit-appearance: none;
    }
    
    input[type="number"]:focus {
      border: 1.5px solid #1677ff;
      background: #fff;
      box-shadow: 0 0 0 2px #e3f0ff;
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="range"] {
      width: 100%;
      max-width: 180px;
      accent-color: #1677ff;
      margin-right: 8px;
      transition: accent-color 0.2s;
      height: 6px;
      border-radius: 3px;
      background: #e5e6eb;
      outline: none;
      -webkit-appearance: none;
    }
    
    input[type="range"]:hover {
      accent-color: #409eff;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #1677ff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(22, 119, 255, 0.3);
    }
    
    input[type="radio"] {
      accent-color: #1677ff;
      margin-right: 4px;
      cursor: pointer;
      transform: scale(1.2);
    }
    
    .unit {
      margin-left: 2px;
      color: #888;
      font-size: 15px;
      white-space: nowrap;
    }
    
    .leverage-group {
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    
    #expectedLoss, #leverage {
      width: 100px !important;
    }
    
    /* 移动端适配 */
    @media (max-width: 900px) {
      body {
        padding: 12px;
      }
      
      .calculator {
        max-width: 100%;
      }
      
      h3 {
        font-size: 22px;
        margin-bottom: 20px;
      }
      
      .calculator-card {
        padding: 16px;
      }
      
      .input-section {
        gap: 16px;
      }
      
      .input-wrapper {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      input[type="number"] {
        width: 120px;
        font-size: 18px;
        padding: 12px;
      }
      
      input[type="range"] {
        width: 100%;
        max-width: 100%;
      }
      
      .result-value {
        font-size: 24px;
      }
    }
    
    @media (max-width: 600px) {
      body {
        padding: 8px;
      }
      
      h3 {
        font-size: 20px;
        margin-bottom: 16px;
      }
      
      .calculator-card {
        padding: 12px;
      }
      
      .input-section {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .result-section {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .input-group label {
        font-size: 14px;
      }
      
      input[type="number"] {
        width: 100%;
        max-width: 150px;
        font-size: 16px;
      }
      
      .result-value {
        font-size: 22px;
      }
      
      .result-label, .result-unit {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="calculator">
    <h3>以损订仓</h3>
    <div class="calculator-card">
      <div class="input-section">
        <div class="input-group">
          <label>价格区间</label>
          <div class="input-wrapper">
            <span class="unit">开仓价</span>
            <input id="entryPrice" type="number" min="0.01" step="0.01" value="100">
            <span class="unit">止损价</span>
            <input id="stopPrice" type="number" min="0.01" step="0.01" value="99">
          </div>
        </div>
        <div class="input-group">
          <label>预计亏损</label>
          <div class="input-wrapper">
            <input id="expectedLoss" type="number" min="0" value="100">
            <span class="unit">USDT</span>
          </div>
        </div>
        <div class="input-group">
          <label>杠杆设置</label>
          <div class="input-wrapper">
            <input id="leverageRange" type="range" min="5" max="100" step="1" value="100">
            <input id="leverage" type="number" min="1" max="100" value="100">
            <span class="unit">倍</span>
          </div>
        </div>
      </div>
      <div class="result-section">
        <div class="result-card">
          <div class="result-label">持仓金额</div>
          <div class="result-value" id="position">0</div>
          <div class="result-unit">USDT</div>
        </div>
        <div class="result-card">
          <div class="result-label">币种数量</div>
          <div class="result-value" id="coinAmount">0</div>
          <div class="result-unit">个</div>
        </div>
        <div class="result-card">
          <div class="result-label">所需保证金</div>
          <div class="result-value" id="actualPosition">0</div>
          <div class="result-unit">USDT</div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // 获取DOM元素
    const entryPriceInput = document.getElementById('entryPrice');
    const stopPriceInput = document.getElementById('stopPrice');
    const expectedLossInput = document.getElementById('expectedLoss');
    const leverageInput = document.getElementById('leverage');
    const leverageRange = document.getElementById('leverageRange');
    const positionSpan = document.getElementById('position');
    const actualPositionSpan = document.getElementById('actualPosition');
    const coinAmountSpan = document.getElementById('coinAmount');

    // 初始化
    function init() {
      // 从localStorage加载保存的数据
      loadFromLocalStorage();
      // 绑定事件监听器
      bindEvents();
      // 初始计算
      calculate();
    }

    // 绑定事件
    function bindEvents() {
      // 为所有输入元素添加input事件监听器
      [entryPriceInput, stopPriceInput, expectedLossInput, leverageInput, leverageRange].forEach(element => {
        element.addEventListener('input', function() {
          // 杠杆输入框和滑块同步
          if (element === leverageInput) leverageRange.value = leverageInput.value;
          if (element === leverageRange) leverageInput.value = leverageRange.value;
          // 计算结果
          calculate();
          // 保存到localStorage
          saveToLocalStorage();
        });
      });
    }

    // 保存数据到localStorage
    function saveToLocalStorage() {
      const data = {
        entryPrice: entryPriceInput.value,
        stopPrice: stopPriceInput.value,
        expectedLoss: expectedLossInput.value,
        leverage: leverageInput.value
      };
      localStorage.setItem('tradeCalculatorData', JSON.stringify(data));
    }

    // 从localStorage加载数据
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem('tradeCalculatorData');
      if (savedData) {
        const data = JSON.parse(savedData);
        // 设置输入框值
        entryPriceInput.value = data.entryPrice || 100;
        stopPriceInput.value = data.stopPrice || 99;
        expectedLossInput.value = data.expectedLoss || 100;
        leverageInput.value = data.leverage || 100;
        leverageRange.value = data.leverage || 100;
      }
    }

    // 计算函数
    function calculate() {
      // 获取输入值
      const entryPrice = parseFloat(entryPriceInput.value) || 0;
      const stopPrice = parseFloat(stopPriceInput.value) || 0;
      const expectedLoss = parseFloat(expectedLossInput.value) || 0;
      const leverage = parseFloat(leverageInput.value) || 1;
    
      // 验证输入
      if (entryPrice <= 0 || stopPrice <= 0 || expectedLoss <= 0 || leverage <= 0) {
        positionSpan.textContent = '0';
        coinAmountSpan.textContent = '0';
        actualPositionSpan.textContent = '0';
        return;
      }
    
      // 计算（同时支持多头和空头）
      const lossAmount = Math.abs(entryPrice - stopPrice);
      const lossPercent = lossAmount / entryPrice * 100;
      const position = expectedLoss / lossPercent * 100;
      const actualPosition = position / leverage;
      const coinAmount = position / entryPrice;
    
      // 更新显示
      positionSpan.textContent = position.toFixed(2);
      coinAmountSpan.textContent = coinAmount.toFixed(8);
      actualPositionSpan.textContent = actualPosition.toFixed(2);
    }

    // 页面加载完成后初始化
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>